package checker

import "testing"

func TestAnalyzeCORSIssues_WildcardCredentials(t *testing.T) {
	report := &CORSReport{
		AllowsAnyOrigin:  true,
		AllowCredentials: true,
		Issues:           []string{"CORS allows any origin (*)"},
	}

	vulns := analyzeCORSIssues(report, "https://example.com")
	if len(vulns) == 0 {
		t.Fatal("expected vulnerability for wildcard origin with credentials")
	}
	if vulns[0].Severity != "High" {
		t.Fatalf("expected High severity, got %s", vulns[0].Severity)
	}
}

func TestAnalyzeCORSIssues_ExtensionWarnings(t *testing.T) {
	report := &CORSReport{
		Issues: []string{"Cross-Origin-Resource-Policy header missing"},
	}

	vulns := analyzeCORSIssues(report, "https://example.com")
	if len(vulns) != 1 {
		t.Fatalf("expected 1 vulnerability, got %d", len(vulns))
	}
	if vulns[0].Severity != "Medium" {
		t.Fatalf("expected Medium severity, got %s", vulns[0].Severity)
	}
	if vulns[0].Category != "Cross-Origin Resource Sharing (CORS)" {
		t.Fatalf("unexpected category: %s", vulns[0].Category)
	}
}
